<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> React中的ref · 冷暖我自知</title><meta name="description" content="React中的ref - 冷暖我自知"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/TheNightElf/atom.xml" title="冷暖我自知"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/TheNightElf" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">React中的ref</h1><div class="post-info">2017年6月20日</div><div class="post-content"><p>众所周知，<code>React</code> 是一个非常优秀的 <code>UI-Library</code>，它将我们<strong>从事件驱动</strong>带入了<strong>数据驱动</strong>的大潮中。在 <code>React</code> 中，一般通过修改 <code>state</code> 和 <code>props</code> 来更新组件。但是<strong>数据驱动</strong>并不意味着我们就完全不需要操作 <code>DOM</code> 了， <code>ref</code> 就是 <code>React</code> 为我们提供操作 <code>DOM</code> 的一个方法。<br><a id="more"></a></p>
<h4 id="什么时候该使用-ref"><a href="#什么时候该使用-ref" class="headerlink" title="什么时候该使用 ref ?"></a>什么时候该使用 <code>ref</code> ?</h4><blockquote>
<p>There are a few good use cases for refs:</p>
<ul>
<li>Managing focus, text selection, or media playback.</li>
<li>Triggering imperative animations.</li>
<li>Integrating with third-party DOM libraries.</li>
</ul>
</blockquote>
<p>官方给出的对于 <code>ref</code> 应该被使用的三种情况。</p>
<ol>
<li>需要操作 <code>input</code> 框的 <code>focus</code> 状态、文本的选中、媒体资源回放等。</li>
<li>触发必要的动画。</li>
<li>集成了第三方操作 <code>DOM</code> 的库。</li>
</ol>
<p>虽然给出了使用 <code>ref</code> 的场景，但是 <code>React</code> 还是非常不推荐使用 <code>ref</code> 的。</p>
<h4 id="ref是什么？"><a href="#ref是什么？" class="headerlink" title="ref是什么？"></a>ref是什么？</h4><p><code>ref</code> 取自英文单词 <code>reference</code>，意为<strong>引用</strong>。在 <code>React</code> 中， <code>ref</code> 表示对 <strong>组件/DOM</strong> 的真实引用而非在 <strong>虚拟DOM</strong> 中的引用。所以，在通过 <code>ref</code> 访问到的 <code>DOM结构</code> 和 <code>组件</code> 都是已经存在于页面上的。需要注意的是，这里所说的 <code>组件</code> 指的是 <strong>有状态的组件——可以被实例化</strong> 而非无状态的组件。引用组件后，可以通过该组件的实例访问其内部的 <code>state</code> &amp; <code>props</code> &amp; <code>method</code>。</p>
<h4 id="ref的使用"><a href="#ref的使用" class="headerlink" title="ref的使用"></a>ref的使用</h4><p>官方给出了两种 <code>ref</code> 的使用方式：</p>
<ul>
<li><p>回调函数(推荐)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    getInput = <span class="function">(<span class="params">ref</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 回调函数中的参数 `ref` 就是当前的真实 `DOM`。 </span></span><br><span class="line">        <span class="built_in">console</span>.log(ref)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.textInput = ref;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    focusInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.textInput.focus()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.focusInput&#125;&gt;click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &#123;/</span>*&lt;input ref=&#123;this.getInput()&#125;/&gt;*/&#125;</span><br><span class="line">                &lt;input ref=&#123;ref =&gt; this.textInput = ref&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <strong>使用回调函数的触发时机</strong></p>
<ul>
<li>组件被渲染后，回调参数 <code>ref</code> 为input的dom对象</li>
<li>组件被卸载后，回调参数 <code>ref</code> 为null，确保内存不被泄露</li>
<li><code>ref</code> 被改变</li>
</ul>
</li>
<li><p>使用字符串</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    focusInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.refs.textInput.focus()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.focusInput&#125;&gt;click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;input ref='textInput'/</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>使用字符串时，通过 <code>this.refs</code> 访问dom或者组件实例。</p>
<h4 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h4><p>最后，还是要引用官方说的一句话：</p>
<blockquote>
<p><strong> Don’t Overuse Refs </strong></p>
</blockquote>
<p>既然我们选择了使用 <code>React</code> 我们就要习惯于使用数据来驱动组件更新，如果还是频繁的使用DOM操作，那和使用 <code>jQuery</code> 有什么区别呢？</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/10/02/React16.0.0/" class="prev">上一篇</a><a href="/2017/06/11/右键菜单/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://github.com/TheNightElf">冷暖我自知</a></p></div></footer></div></body></html>