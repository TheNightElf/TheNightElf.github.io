<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 现代浏览器的类名操作 · 冷暖我自知</title><meta name="description" content="现代浏览器的类名操作 - 冷暖我自知"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/TheNightElf/atom.xml" title="冷暖我自知"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/TheNightElf" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">现代浏览器的类名操作</h1><div class="post-info">2017年12月27日</div><div class="post-content"><p>在前端 <code>MV*</code> 框架还未兴起的时期，绝大部分的前端网站都是基于 <code>事件驱动</code> 的。而这种网站总是不可避免的伴随着大量的 <code>DOM操作</code>。其中，<code>类名 - class</code> 的操作算是其中最平常也是最方便、通用的一种。</p>
<a id="more"></a>
<h3 id="类名操作"><a href="#类名操作" class="headerlink" title="类名操作"></a>类名操作</h3><p>说起类名操作，大部分人的第一反应就是 <code>jquery</code> 中的 <code>addClass、removeClass、hasClass、toggleClass</code> 这几个组合了。<br>下面我们看下 <code>jquery</code> 源码中是怎么实现的。</p>
<h4 id="addClass"><a href="#addClass" class="headerlink" title="addClass"></a>addClass</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// addClass</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addClass</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> classes, elem, cur, curValue, clazz, j, finalValue,</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( jQuery.isFunction( value ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each( <span class="function"><span class="keyword">function</span>(<span class="params"> j </span>) </span>&#123;</span><br><span class="line">            jQuery( <span class="keyword">this</span> ).addClass( value.call( <span class="keyword">this</span>, j, getClass( <span class="keyword">this</span> ) ) );</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> value === <span class="string">"string"</span> &amp;&amp; value ) &#123;</span><br><span class="line">        classes = value.match( rnothtmlwhite ) || [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( ( elem = <span class="keyword">this</span>[ i++ ] ) ) &#123;</span><br><span class="line">            curValue = getClass( elem );</span><br><span class="line">            cur = elem.nodeType === <span class="number">1</span> &amp;&amp; ( <span class="string">" "</span> + stripAndCollapse( curValue ) + <span class="string">" "</span> );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( cur ) &#123;</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> ( ( clazz = classes[ j++ ] ) ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( cur.indexOf( <span class="string">" "</span> + clazz + <span class="string">" "</span> ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">                        cur += clazz + <span class="string">" "</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Only assign if different to avoid unneeded rendering.</span></span><br><span class="line">                finalValue = stripAndCollapse( cur );</span><br><span class="line">                <span class="keyword">if</span> ( curValue !== finalValue ) &#123;</span><br><span class="line">                    elem.setAttribute( <span class="string">"class"</span>, finalValue );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="removeClass"><a href="#removeClass" class="headerlink" title="removeClass"></a>removeClass</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// removeClass </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeClass</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> classes, elem, cur, curValue, clazz, j, finalValue,</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( jQuery.isFunction( value ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each( <span class="function"><span class="keyword">function</span>(<span class="params"> j </span>) </span>&#123;</span><br><span class="line">            jQuery( <span class="keyword">this</span> ).removeClass( value.call( <span class="keyword">this</span>, j, getClass( <span class="keyword">this</span> ) ) );</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">arguments</span>.length ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.attr( <span class="string">"class"</span>, <span class="string">""</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> value === <span class="string">"string"</span> &amp;&amp; value ) &#123;</span><br><span class="line">        classes = value.match( rnothtmlwhite ) || [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( ( elem = <span class="keyword">this</span>[ i++ ] ) ) &#123;</span><br><span class="line">            curValue = getClass( elem );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// This expression is here for better compressibility (see addClass)</span></span><br><span class="line">            cur = elem.nodeType === <span class="number">1</span> &amp;&amp; ( <span class="string">" "</span> + stripAndCollapse( curValue ) + <span class="string">" "</span> );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( cur ) &#123;</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> ( ( clazz = classes[ j++ ] ) ) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Remove *all* instances</span></span><br><span class="line">                    <span class="keyword">while</span> ( cur.indexOf( <span class="string">" "</span> + clazz + <span class="string">" "</span> ) &gt; <span class="number">-1</span> ) &#123;</span><br><span class="line">                        cur = cur.replace( <span class="string">" "</span> + clazz + <span class="string">" "</span>, <span class="string">" "</span> );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Only assign if different to avoid unneeded rendering.</span></span><br><span class="line">                finalValue = stripAndCollapse( cur );</span><br><span class="line">                <span class="keyword">if</span> ( curValue !== finalValue ) &#123;</span><br><span class="line">                    elem.setAttribute( <span class="string">"class"</span>, finalValue );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="hasClass"><a href="#hasClass" class="headerlink" title="hasClass"></a>hasClass</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hasClass</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasClass</span>(<span class="params"> selector </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> className, elem,</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    className = <span class="string">" "</span> + selector + <span class="string">" "</span>;</span><br><span class="line">    <span class="keyword">while</span> ( ( elem = <span class="keyword">this</span>[ i++ ] ) ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( elem.nodeType === <span class="number">1</span> &amp;&amp;</span><br><span class="line">            ( <span class="string">" "</span> + stripAndCollapse( getClass( elem ) ) + <span class="string">" "</span> ).indexOf( className ) &gt; <span class="number">-1</span> ) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="toggleClass"><a href="#toggleClass" class="headerlink" title="toggleClass"></a>toggleClass</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// toggleClass </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleClass</span>(<span class="params"> value, stateVal </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = <span class="keyword">typeof</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> stateVal === <span class="string">"boolean"</span> &amp;&amp; type === <span class="string">"string"</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> stateVal ? <span class="keyword">this</span>.addClass( value ) : <span class="keyword">this</span>.removeClass( value );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( jQuery.isFunction( value ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each( <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><br><span class="line">            jQuery( <span class="keyword">this</span> ).toggleClass(</span><br><span class="line">                value.call( <span class="keyword">this</span>, i, getClass( <span class="keyword">this</span> ), stateVal ),</span><br><span class="line">                stateVal</span><br><span class="line">            );</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> className, i, self, classNames;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( type === <span class="string">"string"</span> ) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Toggle individual class names</span></span><br><span class="line">            i = <span class="number">0</span>;</span><br><span class="line">            self = jQuery( <span class="keyword">this</span> );</span><br><span class="line">            classNames = value.match( rnothtmlwhite ) || [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ( ( className = classNames[ i++ ] ) ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Check each className given, space separated list</span></span><br><span class="line">                <span class="keyword">if</span> ( self.hasClass( className ) ) &#123;</span><br><span class="line">                    self.removeClass( className );</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    self.addClass( className );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Toggle whole class name</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( value === <span class="literal">undefined</span> || type === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">            className = getClass( <span class="keyword">this</span> );</span><br><span class="line">            <span class="keyword">if</span> ( className ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Store className if set</span></span><br><span class="line">                dataPriv.set( <span class="keyword">this</span>, <span class="string">"__className__"</span>, className );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If the element has a class name or if we're passed `false`,</span></span><br><span class="line">            <span class="comment">// then remove the whole classname (if there was one, the above saved it).</span></span><br><span class="line">            <span class="comment">// Otherwise bring back whatever was previously saved (if anything),</span></span><br><span class="line">            <span class="comment">// falling back to the empty string if nothing was stored.</span></span><br><span class="line">            <span class="keyword">if</span> ( <span class="keyword">this</span>.setAttribute ) &#123;</span><br><span class="line">                <span class="keyword">this</span>.setAttribute( <span class="string">"class"</span>,</span><br><span class="line">                    className || value === <span class="literal">false</span> ?</span><br><span class="line">                    <span class="string">""</span> :</span><br><span class="line">                    dataPriv.get( <span class="keyword">this</span>, <span class="string">"__className__"</span> ) || <span class="string">""</span></span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部的代码逻辑我就不再分析了，这种代码最明显的特点：<code>大量的循环和判断</code>。<br>对于以前的前端环境来说，这种写法无可厚非，它能让我们的代码更加的健壮，能兼容几乎所有的浏览器环境了。但是如今，随着 <code>大前端</code> 的兴起，浏览器对于 <code>js - css - html</code> 的支持能力已经发生了翻天覆地的变化，我们可以用最简单、快速的方式实现上面的操作。</p>
<h3 id="Element-classList"><a href="#Element-classList" class="headerlink" title="Element.classList"></a>Element.classList</h3><p>我们先看下官方对于该属性的介绍：</p>
<blockquote>
<p>Element.classList 是一个只读属性，返回一个元素的类属性的实时 DOMTokenList集合。<br>使用 classList 是一个方便的替代方法，通过element.className作为空格分隔的字符串访问元素的类列表。</p>
</blockquote>
<p>更加通俗的讲：<br>之前我们获取一个元素类名的集合时，需要先使用 <code>element.className</code> 获取类名的字符串，之后在 <code>split</code> 成一个集合。而使用 <code>element.classList</code> 时，我们能直接获取元素类名的集合(<strong>这里是集合，不是数组</strong>)。</p>
<h3 id="Element-classList-的类名操作"><a href="#Element-classList-的类名操作" class="headerlink" title="Element.classList 的类名操作"></a>Element.classList 的类名操作</h3><p>上面说到，<code>element.classList</code> 返回一个类名的集合，该集合是与元素的 <code>class</code> 相互映射的。也就是说，我们只要向 <code>classList</code> 中添加一个 <code>class</code> 这个 <code>class</code> 就会映射到真实的元素上。为此<code>DOMTokenList</code> 提供了一套操作的方法来允许开发者操作 <code>classList</code>。</p>
<h4 id="addClass-classList-add"><a href="#addClass-classList-add" class="headerlink" title="addClass - classList.add"></a>addClass - classList.add</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加类名</span></span><br><span class="line">element.classList.add(<span class="string">'added-class'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="removeClass-classList-remove"><a href="#removeClass-classList-remove" class="headerlink" title="removeClass - classList.remove"></a>removeClass - classList.remove</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除类名</span></span><br><span class="line">element.classList.remove(<span class="string">'removed-class'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="hasClass-classList-contains"><a href="#hasClass-classList-contains" class="headerlink" title="hasClass - classList.contains"></a>hasClass - classList.contains</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否存在类名</span></span><br><span class="line">element.classList.contains(<span class="string">'contains-class'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="toggleClass-classList-toggle"><a href="#toggleClass-classList-toggle" class="headerlink" title="toggleClass - classList.toggle"></a>toggleClass - classList.toggle</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类名切换</span></span><br><span class="line">element.classList.toggle(<span class="string">'toggled-class'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类名切换 - while</span></span><br><span class="line"><span class="comment">// 当第二个参数的表达式满足条件时，执行 toggle 操作</span></span><br><span class="line"><span class="comment">// 该方法目前还在 **实验** 阶段</span></span><br><span class="line">element.classList.toggle(<span class="string">'toggled-class'</span>, i &lt; <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>上面列举的这些方法已经在 <code>ie10</code> 以上的浏览器上普及，可以直接使用。<br>更多 <code>classList</code> 的方法可以参考<a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList" target="_blank" rel="noopener">这里</a>。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/03/箭头函数/" class="prev">上一篇</a><a href="/2017/12/26/逻辑符号/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://github.com/TheNightElf">冷暖我自知</a></p></div></footer></div></body></html>