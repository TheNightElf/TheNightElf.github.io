<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 优化双重循环 · 冷暖我自知</title><meta name="description" content="优化双重循环 - 冷暖我自知"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/TheNightElf/atom.xml" title="冷暖我自知"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/TheNightElf" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">优化双重循环</h1><div class="post-info">2017年5月26日</div><div class="post-content"><p>实际开发中或者部分的面试题中偶尔会遇到 <code>双重循环</code> 的问题，直接使用 <code>循环嵌套</code> 的效率又太低。<br><a id="more"></a></p>
<h3 id="场景再现"><a href="#场景再现" class="headerlink" title="场景再现"></a>场景再现</h3><p>下面有两个数组，用最优的方式得出其中 <code>id</code> 相同的项。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [&#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'aaa'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'bbb'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">'ccc'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">4</span>,</span><br><span class="line">    name: <span class="string">'ddd'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">5</span>,</span><br><span class="line">    name: <span class="string">'eee'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">6</span>,</span><br><span class="line">    name: <span class="string">'fff'</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr2 = [&#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'aaa'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">7</span>,</span><br><span class="line">    name: <span class="string">'ggg'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">12</span>,</span><br><span class="line">    name: <span class="string">'lll'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">10</span>,</span><br><span class="line">    name: <span class="string">'jjj'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">5</span>,</span><br><span class="line">    name: <span class="string">'eee'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">9</span>,</span><br><span class="line">    name: <span class="string">'iii'</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure></p>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><p><strong>嵌套循环</strong><br>通过双重 <code>for/forEach循环</code> 对比两个数组中的每一项，求出 <code>id</code> 相同的项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; arr2.length; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr1[i].id === arr2[j].id) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方法应该是每个会编程的人都会使用的一种方法，而且也是最简单的方法。如果这两个数组，每个数组各有 <code>9项</code>，那么为了得出结果，我们需要遍历 <code>9 * 9</code> 次，复杂度为 <code>81</code> 次。</p>
<p><strong>降低空间指数</strong><br>通过遍历数组结合字典查询降低空间指数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [maxArr, minArr] = arr1.length &gt; arr2.length ? [arr1, arr2] : [arr2, arr1];</span><br><span class="line"><span class="keyword">let</span> tempObj = &#123;&#125;, result = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里我们可以得出遍历 maxArr 所需的复杂度 m</span></span><br><span class="line"><span class="comment">// 一般情况下，我们使用长度最长的数组作为父本</span></span><br><span class="line">maxArr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    tempObj[item.id] = item</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里我们可以得出遍历 maxArr 所需的复杂度 n</span></span><br><span class="line">minArr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(temoObj[item.id] === item.id) &#123;</span><br><span class="line">        result.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果集 result 就是 id 相同的项</span></span><br><span class="line"><span class="comment">// 复杂度为 m + n</span></span><br></pre></td></tr></table></figure>
<p><strong>使用es6语法一</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> spreadArr = [...arr1, ...arr2];</span><br><span class="line"><span class="keyword">let</span> tempObj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 spreadArr 的复杂度为 arr1 的复杂度 m + arr2 的复杂度 n</span></span><br><span class="line">spreadArr.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果 tempObj 中没有这一项</span></span><br><span class="line">    <span class="keyword">if</span>(!tempObj[item.id]) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            tempObj[item.id]: item</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>使用es6语法二</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里这么转换是因为 new Set() 只能接收纯粹的数组，不能是 JSON 格式</span></span><br><span class="line"><span class="keyword">const</span> setArr1 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr1.map(<span class="function"><span class="params">item</span> =&gt;</span> item.id));</span><br><span class="line"><span class="keyword">const</span> setArr2 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr2.map(<span class="function"><span class="params">item</span> =&gt;</span> item.id));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用数组 filter 方法</span></span><br><span class="line"><span class="comment">// 调用 Set 数据结构的 has 方法</span></span><br><span class="line"><span class="keyword">const</span> filterArr = [...setArr1].filter(<span class="function"><span class="params">item</span> =&gt;</span> setArr2.has(item))</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>es6</code> 语法为我们提供了很多便利的 <code>api</code>，避免我们再去书写那些繁琐的代码。<br>关于 <code>Set</code> 数据结构的更多信息可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="noopener">这里</a>。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/08/拖拽功能/" class="prev">PREV</a><a href="/2017/05/12/Redux-reducer的优化写法/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://github.com/TheNightElf">冷暖我自知</a></p></div></footer></div></body></html>