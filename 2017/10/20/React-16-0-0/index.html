<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> React.16.0.0 · 冷暖我自知</title><meta name="description" content="React.16.0.0 - 冷暖我自知"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.ico"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/TheNightElf/atom.xml" title="冷暖我自知"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/TheNightElf" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">React.16.0.0</h1><div class="post-info">2017年10月20日</div><div class="post-content"><p><code>React</code> 的版本从 <code>15.6.2</code> 升级到 <code>16.0.0</code> 不仅更改了 <code>License</code>，其内部也给我们提供了一些非常有实用性的特性，像 <code>createPortal、React.Fragment</code> 等。<br><a id="more"></a></p>
<h3 id="为什么要有-createPortal-？"><a href="#为什么要有-createPortal-？" class="headerlink" title="为什么要有 createPortal ？"></a>为什么要有 <code>createPortal</code> ？</h3><p><code>React</code> 的数据流动是单向传递的，所以我们写的很多的 <code>React</code> 的组件中，DOM结构也是 一层套着一层。绝大多数的web网站都会有一个会被频繁使用的全局弹层，如果按照 <code>React</code> 中的 <code>DOM</code> 结构来写的话，那么只能被放在当前的组件内部使用。<code>createPortal</code> 的出现帮我们解决了这个问题，你可以在任何地方使用它并且可以自己指定你的弹层出现的位置。</p>
<h3 id="createPortal-介绍"><a href="#createPortal-介绍" class="headerlink" title="createPortal 介绍"></a><code>createPortal</code> 介绍</h3><p><code>createPortal</code> 的使用非常简单，该方法只接受两个参数：</p>
<ul>
<li>一个是你要添加的DOM节点</li>
<li>一个是目标节点。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createPortal(</span><br><span class="line">    dom,  <span class="comment">// 你要添加的DOM结构</span></span><br><span class="line">    targetDom  <span class="comment">// 放置该DOM结构的位置</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="自己实现一个全局提示"><a href="#自己实现一个全局提示" class="headerlink" title="自己实现一个全局提示"></a>自己实现一个全局提示</h3><p>模仿 <code>antd</code> 中 <code>message</code> 组件的使用方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;render, createPortal&#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>(...arguments);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.node = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123;during&#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.node);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 弹层显示时间达到后移除</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(<span class="keyword">this</span>.node);</span><br><span class="line">        </span><br><span class="line">        &#125;, during);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123;type&#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> createPortal(</span><br><span class="line">            &lt;div className=&#123;<span class="string">`global-message global-message-<span class="subst">$&#123;type&#125;</span>`</span>&#125;&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    type === <span class="string">'success'</span> ? &lt;Icon type='check-circle'/&gt; :</span><br><span class="line">                        type === 'error' ? &lt;Icon type='exclamation-circle-o'/&gt; : null</span><br><span class="line">                &#125;</span><br><span class="line">                &#123;this.props.children&#125;</span><br><span class="line">            &lt;/div&gt;,</span><br><span class="line">            this.node</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line"></span><br><span class="line">        document.body.removeChild(this.node);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    success: function (txt, during = 3000) &#123;</span><br><span class="line"></span><br><span class="line">        let far = document.createElement('div');</span><br><span class="line"></span><br><span class="line">        render(</span><br><span class="line">            &lt;Message during=&#123;during&#125; type='success'&gt;&#123;txt&#125;&lt;/Message&gt;,</span><br><span class="line">            far</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    &#125;,</span><br><span class="line">    error: function (txt, during = 3000) &#123;</span><br><span class="line"></span><br><span class="line">        let far = document.createElement('div');</span><br><span class="line"></span><br><span class="line">        render(</span><br><span class="line">            &lt;Message during=&#123;during&#125; type='error'&gt;&#123;txt&#125;&lt;/Message&gt;,</span><br><span class="line">            far</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以在任何组件内部调用 <code>Message</code> 组件了，它会为我们在全局的DOM结构上展示一个我们想要的 <code>DOM</code> 结构。</p>
<h3 id="顺便一提-–-React-Fragment"><a href="#顺便一提-–-React-Fragment" class="headerlink" title="顺便一提 – React.Fragment"></a>顺便一提 – <code>React.Fragment</code></h3><p>通俗的，你可以把它理解为 <code>document.fragment</code> 的 <code>React</code> 版。它的出现意味着我们可以直接渲染两个并列的同级组件，而不是每次都要在他们外层套一个无用的 <code>div</code> 标签。</p>
<p><strong>错误写法：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这种写法在React中是会报错的</span></span><br><span class="line">render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;li&gt;<span class="number">1</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;2&lt;/</span>li&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>正确写法：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;React.Fragment&gt;</span><br><span class="line">            &lt;li&gt;<span class="number">1</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            &lt;li&gt;2&lt;/</span>li&gt;</span><br><span class="line">        &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="剩下的特性"><a href="#剩下的特性" class="headerlink" title="剩下的特性"></a>剩下的特性</h3><p><code>render</code> 方法不再只能渲染 <code>DOM</code> 结构了，现在你可以用它来渲染 <code>Array</code> &amp; <code>String</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">render () &#123;</span><br><span class="line">    <span class="comment">// return [1, 2, 3]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>componentDidCatch</code> 就不说了，它的用法很简单，想了解的可以去官方文档上找找。就写这么多吧，干活去了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/2018/03/04/关于数据结构的设计/" class="prev">PREV</a><a href="/blog/2017/06/20/React中的ref/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://github.com/TheNightElf">冷暖我自知</a></p></div></footer></div></body></html>