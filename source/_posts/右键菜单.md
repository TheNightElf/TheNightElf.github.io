---
title: 右键菜单
date: 2017-06-11 14:17:09
tags:
---

这几天写了一个**自定义右键菜单**的功能，在这里记录下吧。
<!-- more -->

### 前言

自定义右键菜单也算是一个很常见的功能了，一般大多数的网盘空间都会使用自定义右键菜单。


#### 实现右键菜单

这里假设我们有这样的一个 `HTML` 结构。`container` 是外部容器， `right-menu` 则是我们需要展示的右键菜单。


```html
<style>
    .container {
        width: 800px;
        height: 300px;
        position: relative;
    }

    .hide {
        display: none !important;
    }

    .right-menu {
        width: 80px;
        height: 120px;
        position: absolute;
        top: 0;
        left: 0;
    }
</style>


<div class='container'>
    <!-- 内容区域 -->
    <div class='content'>

        <div class='content-item'></div>
        <div class='content-item'></div>
        <div class='content-item'></div>
        <!-- ... -->

    </div>


    <div class='right-menu hide'>
        <!-- 右键菜单内容区域 -->
    </div>
</div>
```

1. 想要使用自己的右键菜单我们必须先禁用浏览器自带的右键菜单，然后在当前鼠标位置展示我们自己的菜单。

```js
// 右键菜单事件
let container = document.querySelector('.container');
    menu = document.querySelector('.container .right-menu');

container.addEventListener('contextMenu', (e) => {
    // 禁用浏览器事件
    e.preventDefault();

    menu.classList.remove('hide');
    menu.style.left = e.target.offsetX + 'px';
    menu.style.top = e.target.offsetY + 'px';

})

// 隐藏菜单
document.addEventListener('click', () => {

    if(!menu.classList.contains('hide')) return;
    menu.classList.add('hide');
})
```

卧槽，没想到这次这么快就...

#### 补充点内容

上面写的只是最简单的一种情况——右键菜单在容器上触发。实际情况下，触发的元素不是在容器上，而是在容器的内容上。
也就是结构中的 `content-item` 上。这个时候右键菜单的位置就不能根据 `e.target.offsetX` 和 `e.target.offsetY` 来确定了。

```js
// ...
    
    menu.style.left = e.target.offsetX + parseInt(e.target.parentNode.offsetLeft) +'px';
    menu.style.top = e.target.offsetY + parseInt(e.target.parentNode.offsetTop) + 'px';

//...
```

到这里是真的没什么要补充的了，我还是想想下次写什么能写长一点把。






