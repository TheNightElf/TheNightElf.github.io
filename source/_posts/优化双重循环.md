---
title: 优化双重循环
date: 2017-05-26 17:29:21
tags:
---

实际开发中或者部分的面试题中偶尔会遇到 `双重循环` 的问题，直接使用 `循环嵌套` 的效率又太低。
<!-- more -->

### 场景再现

下面有两个数组，用最优的方式得出其中 `id` 相同的项。
```js
let arr1 = [{
    id: 1,
    name: 'aaa'
}, {
    id: 2,
    name: 'bbb'
}, {
    id: 3,
    name: 'ccc'
}, {
    id: 4,
    name: 'ddd'
}, {
    id: 5,
    name: 'eee'
}, {
    id: 6,
    name: 'fff'
}];

let arr2 = [{
    id: 1,
    name: 'aaa'
}, {
    id: 7,
    name: 'ggg'
}, {
    id: 12,
    name: 'lll'
}, {
    id: 10,
    name: 'jjj'
}, {
    id: 5,
    name: 'eee'
}, {
    id: 9,
    name: 'iii'
}]
```

#### 方案

**嵌套循环**
通过双重 `for/forEach循环` 对比两个数组中的每一项，求出 `id` 相同的项。

```js
for(var i = 0; i < arr1.length; i++) {
    for(var j = 0; j < arr2.length; j++) {
        if(arr1[i].id === arr2[j].id) {
            // ...
        }
    }
}
```

这种方法应该是每个会编程的人都会使用的一种方法，而且也是最简单的方法。如果这两个数组，每个数组各有 `9项`，那么为了得出结果，我们需要遍历 `9 * 9` 次，复杂度为 `81` 次。


**降低空间指数**
通过遍历数组结合字典查询降低空间指数。

```js
const [maxArr, minArr] = arr1.length > arr2.length ? [arr1, arr2] : [arr2, arr1];
let tempObj = {}, result = [];

// 这里我们可以得出遍历 maxArr 所需的复杂度 m
// 一般情况下，我们使用长度最长的数组作为父本
maxArr.forEach(item => {
    tempObj[item.id] = item
})

// 这里我们可以得出遍历 maxArr 所需的复杂度 n
minArr.forEach(item => {
    if(temoObj[item.id] === item.id) {
        result.push(item)
    }
})

// 结果集 result 就是 id 相同的项
// 复杂度为 m + n
```

**使用es6语法一**

```js
const spreadArr = [...arr1, ...arr2];
let tempObj = {}

// 遍历 spreadArr 的复杂度为 arr1 的复杂度 m + arr2 的复杂度 n
spreadArr.map(item => {
    // 如果 tempObj 中没有这一项
    if(!tempObj[item.id]) {
        return {
            tempObj[item.id]: item
        }
    }
})

```

**使用es6语法二**

```js
// 这里这么转换是因为 new Set() 只能接收纯粹的数组，不能是 JSON 格式
const setArr1 = new Set(arr1.map(item => item.id));
const setArr2 = new Set(arr2.map(item => item.id));

// 调用数组 filter 方法
// 调用 Set 数据结构的 has 方法
const filterArr = [...setArr1].filter(item => setArr2.has(item))
```

### 总结
`es6` 语法为我们提供了很多便利的 `api`，避免我们再去书写那些繁琐的代码。
关于 `Set` 数据结构的更多信息可以点击[这里](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set)。


