<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 初探Canvas · 冷暖我自知</title><meta name="description" content="初探Canvas - 冷暖我自知"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.ico"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/TheNightElf/atom.xml" title="冷暖我自知"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/TheNightElf" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">初探Canvas</h1><div class="post-info">2018年7月27日</div><div class="post-content"><p><code>Canvas</code> 是一个浏览器自带的图形绘制元素，随着高版本浏览器的普及率，<code>Canvas</code> 已经广泛的应用于日常网站。<br><a id="more"></a></p>
<h3 id="什么是-Canvas"><a href="#什么是-Canvas" class="headerlink" title="什么是 Canvas"></a>什么是 <code>Canvas</code></h3><p><code>Canvas</code> 最早是由 <code>Apple</code> 引入的，用于 <code>OS X Dashboard</code> 和 <code>Safari</code>。<code>Canvas</code> 是 <code>HTML5</code> 新增的一个元素，可用于通过使用 <code>JavaScript</code> 中的脚本来绘制图形。</p>
<p><strong>举个栗子：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Canvas-的属性"><a href="#Canvas-的属性" class="headerlink" title="Canvas 的属性"></a><code>Canvas</code> 的属性</h4><p>实际上，<code>&lt;canvas&gt;</code> 标签只有两个属性—— <code>width</code> 和 <code>height</code>。<br>当没有设置宽度和高度的时候，<code>canvas</code> 会初始化宽度为<code>300px</code>和高度为<code>150px</code>。<br><code>&lt;canvas&gt;</code> 元素可以像任何一个普通的图像一样（有<code>margin，border，background</code>等等属性）被设计。然而，这些样式不会影响在canvas中的实际图像。</p>
<h3 id="使用-Canvas-绘制图形"><a href="#使用-Canvas-绘制图形" class="headerlink" title="使用 Canvas 绘制图形"></a>使用 <code>Canvas</code> 绘制图形</h3><h4 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制一个填充矩形。</span></span><br><span class="line">fillRect(x, y, width, height);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制一个矩形的边框</span></span><br><span class="line">strokeRect(x, y, width, height);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除指定矩形区域</span></span><br><span class="line">clearRect(x, y, width, height);</span><br></pre></td></tr></table></figure>
<p>更简单的方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rect(x, y, width, height);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要注意的是：当该方法执行的时候，moveTo()方法自动设置坐标参数（0,0）</span></span><br></pre></td></tr></table></figure>
<h4 id="绘制路径"><a href="#绘制路径" class="headerlink" title="绘制路径"></a>绘制路径</h4><p>一个路径，甚至一个子路径，都是闭合的。使用路径绘制图形需要一些额外的步骤。</p>
<ul>
<li>创建路径起始点。</li>
<li>使用画图命令去画出路径。</li>
<li>把路径封闭。</li>
<li>一旦路径生成，就能通过描边或填充路径区域来渲染图形。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建一条路径</span></span><br><span class="line">beginPath();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭合路径。如果图形是已经闭合了的，即当前点为开始点，该函数什么也不做。</span></span><br><span class="line"><span class="comment">// 当调用 fill() 时，会自动 closePath(); 但 stroke() 并不会。</span></span><br><span class="line">closePath();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制图形轮廓</span></span><br><span class="line">stroke();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 填充路径内容区域</span></span><br><span class="line">fill();</span><br></pre></td></tr></table></figure>
<h4 id="移动笔触"><a href="#移动笔触" class="headerlink" title="移动笔触"></a>移动笔触</h4><p>将绘制的点移动到另一个位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moveTo(x, y)</span><br></pre></td></tr></table></figure>
<h4 id="绘制直线"><a href="#绘制直线" class="headerlink" title="绘制直线"></a>绘制直线</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lineTo(x, y)</span><br></pre></td></tr></table></figure>
<h4 id="绘制圆弧"><a href="#绘制圆弧" class="headerlink" title="绘制圆弧"></a>绘制圆弧</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arc(x, y, radius, startAngle, endAngle, anticlockwise);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解释：</span></span><br><span class="line"><span class="comment">// 画一个以 x, y 为圆心，以 radius 为半径的圆弧(圆)</span></span><br><span class="line"><span class="comment">// 从 startAngle弧度 开始 至 endAngle弧度 结束，</span></span><br><span class="line"><span class="comment">// anticlockwise: bool; false=顺时针, true=逆时针</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// eg:</span></span><br><span class="line">arc(<span class="number">75</span>,<span class="number">75</span>,<span class="number">35</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI,<span class="literal">false</span>);</span><br><span class="line">arc(<span class="number">60</span>,<span class="number">65</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h4 id="二次贝塞尔曲线及三次贝塞尔曲线"><a href="#二次贝塞尔曲线及三次贝塞尔曲线" class="headerlink" title="二次贝塞尔曲线及三次贝塞尔曲线"></a>二次贝塞尔曲线及三次贝塞尔曲线</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二次</span></span><br><span class="line">quadraticCurveTo(cp1x, cp1y, x, y);</span><br><span class="line"><span class="comment">// cp1x,cp1y 表示控制点，x,y 表示结束点位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 三次</span></span><br><span class="line">bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)</span><br><span class="line"><span class="comment">// cp1x,cp1y 表示第一个控制点，cp2x,cp2y 表示第二个控制点，x,y 表示结束点</span></span><br></pre></td></tr></table></figure>
<p>如下图所示：<br><img src="https://mdn.mozillademos.org/files/223/Canvas_curves.png" alt="bezier"></p>
<h4 id="path2D-对象"><a href="#path2D-对象" class="headerlink" title="path2D 对象"></a><code>path2D</code> 对象</h4><p>为了简化代码和提高性能，<code>Path2D</code> 对象 已可以在较新版本的浏览器中使用，用来缓存或记录绘画命令，这样你将能快速地回顾路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创造一个 Path2D 对象</span></span><br><span class="line"><span class="keyword">new</span> Path2D();  <span class="comment">// -&gt; 空的 Path 对象</span></span><br><span class="line"><span class="keyword">new</span> Path2D(path);  <span class="comment">// -&gt; 克隆 Path 对象</span></span><br><span class="line"><span class="keyword">new</span> Path2D(svg);  <span class="comment">// -&gt; 从 Svg 建立 Path 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个 path</span></span><br><span class="line">Path2D.addPath(path, [, transform]);</span><br></pre></td></tr></table></figure>
<p>举个栗子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先创建一个 path 对象，并画一个矩形</span></span><br><span class="line"><span class="comment">// var p1 = new Path2D("M10 10 h 80 v 80 h -80 Z");</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Path2D();</span><br><span class="line">p1.rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 p2 克隆 p1, 并画圆</span></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Path2D(p1);</span><br><span class="line">p2.moveTo(<span class="number">220</span>, <span class="number">60</span>);</span><br><span class="line">p2.arc(<span class="number">170</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 什么都没有</span></span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有矩形</span></span><br><span class="line">ctx.stroke(p1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 成功画出一个矩形和圆形</span></span><br><span class="line">ctx.stroke(p2);</span><br></pre></td></tr></table></figure>
<h4 id="色彩"><a href="#色彩" class="headerlink" title="色彩"></a>色彩</h4><p><code>color</code> 的取值方式与 <code>css</code> 中取值相同。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 填充颜色</span></span><br><span class="line">fillStyle = color;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 描边颜色</span></span><br><span class="line">strokeStyle = color;</span><br></pre></td></tr></table></figure></p>
<h4 id="全局图形透明度"><a href="#全局图形透明度" class="headerlink" title="全局图形透明度"></a>全局图形透明度</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局透明度默认为 1， 取值范围为 [0.0, 1];</span></span><br><span class="line">globalAlpha = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h4 id="线型"><a href="#线型" class="headerlink" title="线型"></a>线型</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置线条宽度, 默认为 1，必须为正数</span></span><br><span class="line">lineWidth = value;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置线条末端样式，默认为butt，[butt, round, square]</span></span><br><span class="line">lineCap = type;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置线条与线条接合处样式，默认为miter， [round, bevel, miter]</span></span><br><span class="line">lineJoin = type;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制当两条线相交时交接处最大长度；所谓交接处长度（斜接长度）是指线条交接处内角顶点到外角顶点的长度。</span></span><br><span class="line"><span class="comment">// 我没看懂</span></span><br><span class="line">miterLimit = value;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个包含当前虚线样式，长度为非负偶数的数组</span></span><br><span class="line">getLineDash();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置当前虚线样式</span></span><br><span class="line">setLineDash(segments: array);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置虚线样式的起始偏移量</span></span><br><span class="line">lineDashOffset = value;</span><br></pre></td></tr></table></figure>
<h4 id="渐变"><a href="#渐变" class="headerlink" title="渐变"></a>渐变</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线性渐变</span></span><br><span class="line">createLinearGradient(x1, y1, x2, y2);</span><br><span class="line"><span class="comment">//渐变的起点 (x1,y1) 与终点 (x2,y2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 径向渐变</span></span><br><span class="line">createRadialGradient(x1, y1, r1, x2, y2, r2);</span><br><span class="line"><span class="comment">// x1, y1, r1，坐标为(x1, y1)，半径为 r1 的圆</span></span><br><span class="line"><span class="comment">// x2, y2, r2，坐标为(x2, y2)，半径为 r2 的圆</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置完渐变后再上色</span></span><br><span class="line"><span class="comment">// position 取值 [0, 1], color 同 css</span></span><br><span class="line">gradient.addColorStop(position, color);</span><br></pre></td></tr></table></figure>
<p>举个栗子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lg = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">lg.addColorStop(<span class="number">0</span>, <span class="string">'white'</span>)</span><br><span class="line">lg.addColorStop(<span class="number">1</span>, <span class="string">'black'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 径向渐变同理</span></span><br></pre></td></tr></table></figure>
<h4 id="图案样式"><a href="#图案样式" class="headerlink" title="图案样式"></a>图案样式</h4><p>通过 <code>createPattern</code> 实现图案。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createPattern(image, type);</span><br><span class="line"></span><br><span class="line"><span class="comment">// image 是一个 Image 对象的引用 或 另一个 Canvas 对象</span></span><br><span class="line"><span class="comment">// type 取 repeat，repeat-x，repeat-y 和 no-repeat 中的一个</span></span><br></pre></td></tr></table></figure>
<h4 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 阴影在 x 轴的延伸距离</span></span><br><span class="line">shadowOffsetX = value;</span><br><span class="line"><span class="comment">// 阴影在 y 轴的延伸距离</span></span><br><span class="line">shadowOffsetY = value;</span><br><span class="line"><span class="comment">// 阴影模糊成都</span></span><br><span class="line">shadowBlur = value;</span><br><span class="line"><span class="comment">// 阴影的颜色</span></span><br><span class="line">shadowColor = color;</span><br></pre></td></tr></table></figure>
<h4 id="填充规则"><a href="#填充规则" class="headerlink" title="填充规则"></a>填充规则</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认值：nonzero</span></span><br><span class="line"><span class="comment">// 可选值：nonzero || evenodd</span></span><br><span class="line"></span><br><span class="line">ctx.fill(<span class="string">'nonzero'</span>)</span><br></pre></td></tr></table></figure>
<p>下一章会继续介绍 <code>Canvas</code> 的其它属性。</p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/2018/08/02/再探Canvas/" class="prev">PREV</a><a href="/blog/2018/03/04/关于数据结构的设计/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://github.com/TheNightElf">冷暖我自知</a></p></div></footer></div></body></html>